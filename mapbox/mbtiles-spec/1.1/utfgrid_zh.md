# UTFGrid

UTFGrid以一种空间高效的方式将交互查询数据编码到瓦片中. 它为浏览器设计, 如在地图瓦片的某个要素上悬停时显示提示.

由于较慢的浏览器和机器无法处理地图瓦片上实际多边形的渲染，此处使用了一种基于格网的方式，存储每个像素的关联信息.

UTFGrid使用JSON格式. 仅面向256x256像素的瓦片.

## 格网Grid

为了在浏览器中实现合理的速度，我们将1个像素对应的信息存储为长字符串，每个字符的Unicode码点是获取信息的键. 当唯一ID少于96个时，单独存储每个像素占用的空间是256 * 256 = 64 KB, 压缩后少于2K.
默认情况下, UTFGrid在2x2网格上进行操作, 也就是说对于256x256像素大小的瓦片它的最大信息分辨率是128x128. 如果每个像素对应不同的信息，需要一个14bit宽的ID(2^14 = 16384)进行表示. 然而，大多数情况下不需要这么多的唯一ID. 这里，我们可利用UTF-8的变长代码点编码方式: 用所有的ASCII字符进行编码，前94个代码点使用1个byte(如 `0x20`, `0x21`, `0x23`-`0x5B` and `0x5D`-`0x7F`). 大于94的IDs采用多个byte进行编码.

## 编码Encoding IDs

[JSON](http://www.ietf.org/rfc/rfc4627) 不允许控制字符, `"` 和 `\` . **编码** 一个唯一ID 遵循下述规则:

* 加 32<sub>10</sub>.
* 如果结果>= 34<sub>10</sub>, 加 1.
* 如果结果>= 92<sub>10</sub>, 加 1.

This ensures that all characters that cannot be represented natively are skipped.

**解码** 遵循下述规则:

* 如果codepoint >= 93<sub>10</sub>, 减 1.
* 如果codepoint >= 35<sub>10</sub>, 减 1.
* 减 32<sub>10</sub>.

## 将ID映射为键key

UTFgrid文件包括根节点名称为`grid` 的数组. 每个元素表示网格中的1行. 每列是一个存储UTF-8编码的代码点(codepoint). 字符串长度取决于`grid` 数组中元素的数量(2的幂).

键存储在根节点名称为 `keys` 的数组. 每个键的索引表示它关联的ID.

从坐标得到key的方法如下(`json` 是根节点层次的对象, `x` 和 `y` 是坐标, 左上角是0, `size` 是 `grid` 键中元素的个数):

* `var factor = 256 / size, row = y / factor, col = x / factor`
* `var id = json.grid[row].charCodeAt(col);` is the character that contains the encoded ID.
* Decode the id as described in *"Encoding IDs"*.
* `var key = json.keys[id];` retrieves the ID associated with the coordinate.

All divisions are integer divisions.

## 将key映射为数据

JSON文件可能在根节点包括一个可选的 `data` 属性. 如果不存在, 客户端在在其自身数据存储中查找key. 如果查找key不存在, 则向服务端进行请求. 如果存在 `data` 属性, 但未找到key, 客户端认为不存在 `data` 属性.

一个空的key 表示该像素不存在相关信息. 对于空白key(`""`)不进行获取数据的任何操作.


##  UTFGrid JSON 示例

    { "grid":
      [
        "                                     !!!!!!!########################$$$$$$$$$$$$$$$$%%%%%%%%%%      %%%%%%%%%%%%%%%%    %      %",
        "                                      !!!!!!########################$$$$$$$$$$$$$$$$$%%%%%%%%%%%      %%%%%%%%%%%%%     %%%%  %%",
        "                                       !!!!!########################$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%         %%%%%%%     %%%%%% %%",
        "                                     !!!!!###########################$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%         %%%       %%%%%%%%%%",
        "                                      !!!!###########################$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%                 %%%%%%%%%%%%",
        "                                    !!!!!!######################  ###$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%                %%%%%%%%%%%%",
        "                                  !  !!!!!######################       $$$$$$$$$$$$$$%%%%%%%%%%%%%%               %%%%%%%%%%%%%%",
        "                                   !!!!!!!#####################         $$$$$$$$$$$$$%%%%%%%%%%%%%%              %%%%%%%%%%%%%%%",
        "                                   !!!!!!!####################           $$$$$$$$$$$$%%%%%%%%%%%%%                %%%%%%%%%%%%%%",
        "                                    !!!!!#####################          $$$$$$$$$$$$$%%%%%%%%%%%%%%               %%%%%%%%%%%%%%",
        "                                 !  !!!!!#####################           $$$$$$$$$$$$%%%%%%%%%%%%%%   %  %%%       %%%%%%%%%%%%%",
        "                               ! !!!!!!!#####################           $$$$$$$$$$$$$%%%%%%%%%%%%%%%    %%%%       %%%%%%%%%%%%%",
        "                                  !!!!!!#####################         $$$$$$$$$$$$$$$$%%%%%%%%%%%%%%    %%%%% %     %%%%%%%%%%%%",
        "                                 !!!!!!######################         $$$$$$$$$$$$$$$$%%%%%%%%%%%%%%     %%%%%%%   %%%%%%%%%%%%%",
        "                               ! !!!!!!!!#####################       $$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%      %%%%%%%%%%%%%%%%%%%%%%",
        "                              !!!!!!!!!!!####################        $$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%      %%%%%%%%%%%%%%%%%%%%",
        "                             !!!!!!!!!!!!###################        $$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%     %%%%%%%%%%%%%%%%%%%",
        "                             !!! !!!!#######################       $$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%     %%%%%%%%%%%%%%%%%%%",
        "                            !!!! !!!########################     $$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%",
        "                         !   !! !!!!#######################       $$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        !!!! !  !!!######################       $$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                       ! ! !!!!!!!!####################         $$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                       !!!!!!!!!!!!####################       $ $$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                      !!!!!!!!!!!!!##################         $$$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                    !!!! !!!!!!!!!!##################        $$$$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                    !!!! !!!!!!!!!!#################         $$$$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                  !!! !!!!!!!!!!!!!#################        $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                  !!!!!!!!!!!!!!!!!###############           $$$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                !!!!!!!!!!!!!!!!!!!###############           $$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!###############           $$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!###############           $$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!###############            $$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!!#############             $$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!!!############             $$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!!!############             $$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "              !  ! !!!!!!!!!!!!!!!!!!############            $$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!##############            $$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!!##############           $$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!!!!!!!!!!!!!!!!!!!################         $ $$$$$$$$$$$$$ $$$% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!!! !!!!!!!!!!!!!!!!################          $ $$$$$$$$$$$$      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                !!!!!!!!!!!!!!!!!!!!#################   & &     $ $$$$$$ $         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                ! !!!!!!!!!!!!!!!!!!##################   &      $ $$$$                %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               ! !!!!!!!!!!!!!!!!!#####################           $                %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                 !!!!!!!!!!!!! !!!####################                          %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "               !!! !!!!!!!!!!! !!!############## #####                   '''    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                ! !!!!!!!!!!!! !!!###################                ''''''''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                  !!!!!!!!!!!! !!!###################              '''''''''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                !!!!!!!!!!!!    #!##################            '''''''''''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                !!!!!!!!!!!     ##################              '' ''''''''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                !!!!!!!!!!       ################                 '''''''''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                 !!!!!!!!       ################               '''' '''''''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                   !!!!!!        ###############               ''     '''''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                   !!!!           ##############               '      ''(''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                                  #############       #               ((((''''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                              )   ##############     #          (     (((((''''%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                             )    ##############    ##        (((     (((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                            ))     ############     ##        ((((    ((((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                          ))))     ############     #        ((((((  (((((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        )  )))      ########### #   #        ((((((((((((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        )) )))      ###########             ((((((((((((((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        ))))))       ###########            ((((((((((((((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        ))))))))     ######### #            (((****((((*(((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        )))))))     ##########              (************((((((((%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        )))))))   )) ####                   **************(((((+++%+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        ))))) )  ))) ####                   ***************((+++++++%++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        )))) )  )))) ####                    ***************++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        )))) )) ))))  #                      ***************++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                         ))) ))   )       )                  %**************+++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                         )))) )    )                         %%%%**********++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                         ,,,,   )))                --    %%%%%%%%*********++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                          ,,,     )   ,         -----     %%%%%%%*********+++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                         ,,,,,,     ,,,,       ------- ----%%%%%%-*******+++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                          ,,,,,,  ,,,,,,    -----------------------*****+*++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                        , ,,,,,  ,,,,,,,, -------------------------***+++++++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".                        ,,,,,,,,,,,,,,,  --------------------------+++++++++++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "                     ,,,,,,,,,,,,,,,,,,,,---------------------------+++++++++++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".                /// ,,,,,,,,,,,,,,,,,,,,---------------------------+++++++++++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".               /////,,,,,,,,,,,,,,,,,,,,---------------------------++++++++++++++++++++++%+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ". ..            /////,,,,,,,,,,,,,,,,,,,,----------------------------+++++++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".....         ///////,,,,,,,,,,,,,,,,,,,,,---------------------------+++++++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".....         //////,,,,,,,,,,,,,,,,,,,,,,-------------------------+++++++++++++++++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".....        ////////,,,,,,,,,,,,,,,,,,,,,------------------------+++++++++++++++++++++++++%%0000%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".....       ////////,,,,,,,,,,,,,,,,,,,,,,--------------------------++++++++++++++++++++000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "....        //////,,,,,,,,,,,,,,,,,,,,,,,,--------------------------++000000++++++++++++0000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "...         //////,,,,,,,,,,,,,,,,,,,,,,,,-------------------------+0000000000+++++0+++00000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "..        ///11///,,,,,,,,,,,,,,,,,,,,,,,,,-------------------------0000000000000000000+0000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        ".....   111111111/,,,,,,,,,,,,,,,,,,,,,,,,,-------------------------0000000000000000000000000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "...   22111111111/,,,,,,,,,,,,,,,,,,,,,,,3,3-------------------------00000000000000000000000000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "     2222211111111,,,,,,,,,,,,,,,,,,,,,,33333------------------------00000000000000000000000000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "     2222221111111,,,,,,,,,,,,,,,,,,,,333333333----------------------00000000000000000000000000000000%%%%%%%%%%%%%%%%%%%%%%%%%%%",
        "     2222222111111,,,,,,,,,,,,,,,,,,33333333333--3------------------000000000000000000000000000000000000%00%%%%%%%%%%%%%%%%%%%%%",
        "    22222222111114,,,,,,,,,,,,,,,,,3333333333333333----------------00000000000000000000000000000000000000000%0%%%%%%%%%%%%%%%%%%",
        "  22222222222211144,,,,,,,,,,,,,,,,,33333333333333333-------------000000000000000000000000000000000000000000000%%%%%%%%%%%%%%%%%",
        " 222222222222222144,,,,,,,,,,,,,,,,,333333333333333333-----------000000000000000000000000000000000000000000000000%0%%%%%%%%%%%%%",
        " 222222222222222222,,,,,,,,,,,,,,,,,,33333333333333335555-55555--00000000000000000000000000000000000000000000000000%%%%%%%%%%%%%",
        "2222222222222222222222,,,,,,,,,,,,,,,,33333333333333555555555555-0000000000000000000000000000000000000000000000000%%%%%%%%%%%%%%",
        "222222222222222222222222,,,,,,,,,,,,,,,333366333333555555555555500000000000000000000000000000000000000000000000000%%%%%%%%%%%%%%",
        "22222222222222222222222,,,,,,,,,,,,,,,,,3366666665555555555555550000000000000000000000000000000000000000000000000%%%%%%%%%%%%%%%",
        "22222222222222222222222,,,,,,,,,,,,,,,,666666666555555555557775500000000000000000000000000000000000000000000000000%%%%%%%%%%%%%%",
        "2222222222222222222222,,,,,,,,,,,,,,,66666666666655555557577777770000000000089990000000000000000000000000000000000%%%%%%%%%%%%%%",
        "2222222222222222222222,,,,,,,,,,,,,,,66666666666675555777777777777880000000888999990000000000000000000000000000000%%%%%%%%%%%%%%",
        "2222222222222222222222,,,,,,,,,,,,,,,66666666666677757777777777788888880888888999999000000000000000000000000000%%%%%%%%%%%%%%%%%",
        "2222222222222222222222::::::6,66,6666,66666666667777777777777778888888888888888999900000000000000000000000000%%%%%%%%%%%%%%%%%%%",
        "22222222222222222222::::::::6,6666666666666666677777777777777778888888888888888999999000000000000000000000000%%%%%%%%%%%%%%%%%%%",
        "22222222222222222222::::::::6666666666666666666777777777777777888888888888888888999990000000000000000000000     %%%%%%%%%%%%%%%%",
        "2222222222222222222:::::::::::;6;;;;6666666666<7777777777777778888888888888888888999990000000000000000000     %%%%%%%%%%%%%%%%%%",
        "222222222222222222:::::::::::;;;;;;;;;;6666<<<<77777777777777888888888888888888889999900    0000000000      %%%%%%%%%%%%%%%%%%%%",
        "22222222222222222222::::;::;;;;;;;;;;;;<<<<<<<===777777777777888888888888888888889900000   000000000         %%%%%%%%%%%%%%%%%%%",
        "22222222222222222222:::;;;;;;;;;;;;;;;;<<<<<<=====777777>>88888888888888888888889990000        00 00         %%%%%%%%%%%%%%%%%%%",
        "22222222222222222222;;;;;;;;;;;;;;;;;;;<<<<<<======77=>>>>>888888888888888888888890000          000         %%%%%%%%%%%%%%%%%%%%",
        "22222222222222222222;;;;;;;;;;;;;;;;;   <<<<==========>>>>>>8888888888888888888899000         000000       %%%%%%%%%%%%%%%%%%%%%",
        "222222222222222222222;;;;;;;;;;;;;;    ================>>>>>8888888888888888888880088         000000  000%  %%%%%%%%%%%%%%%%%%%%",
        "2222222222222222222;;;;;;;;;;;;;;;;;   ==  ==?=????=?==>>>>>>>88888888888888888888888           00000 00 %%%%%%%%%%%%%%%%%%%%%%%",
        "22222222222222222222;;;;;;;;;;;;;;;      = ==???????????>>>>>888888888888888888888888           0000       %%%%%%%%%%%%%%%%%%%%%",
        "22222222222222222222;;;;;;;;;;;;;;;      = ===?????????>>>>>>>>8>88888888888888888             000           %%%%%%%%%%%%%%%%%%%",
        "22222222222222222222;;;;;  ;;;;;;;;;       ====????????>>>>>>>>>>88888888888888888                            %%%%%%%%%%%%%%%%%%",
        "2222222222222222222222;;    ;;;;;;;;        ===?????????>>>>>>>>>@88888888888@8888                              %%%%%%%%%%%%%%%%",
        "2222222222222222222222;       ;;;;;;;;       ===????????>>>>>>>>@@88888888@@@@@@88                               %%%%%%%%%%%%%%%",
        "222222222222222222222         ;;;;;;;;;       ===???????>>>>>>>>@@@@@@@@@@@@@@@@@@                                %%%%%%%%%%%%%%",
        "22222222222     222           ;;;;;;;;;;       = =?????A>>>>>>>>>@@@@@@@@@@@@@@@                                   BBB%%%%%%%%%%",
        "222222222                     ;;;;;;;;;;      =   =???AAA>>>>>>>>>@@@@@@@@@@@@@@                                     BBBBBB%%%%%",
        "22C222222                      ;;;;;;;;;           ??AAAAA>>>>>>@@@@@@@@@@@@@@@@                                     BBBBBBBB%%%",
        "CCCCC2222                222    ;;;;;;;;;           =AAADD>>>>>>@@@@@@@@@@@@@@@                                        BBBBBBBBB",
        "CCCCCCCCCC               222      ;;;;;;;;            AADDD>>>>E@@@@@@@@@@@@@@@                                        BBBBBBBBB",
        "CCCCCCCCCC               22       ;;;;;;;;;            ADDD>EEEEE@@@@@@@@@@@@F@@                                       BBBBBBBBB",
        "CCCCCCCCC                22        ;;;;;;;;;;;;         DDDEEEEEEE@@@@@@@@@FFFFF             FFFFFFFF                  BBBBBBBBB",
        "CCCCCCC                   2         ;;;;;;;;;;          DDDEEEEEEE@@@G@@@@@GFFFFF          FFFFFFFFFFFF                BBBFBBBBB",
        "CCCCCC                                  ;;;;;;;         DDDEEEEEEGGGGGGGGGGFFFFFFFF       FFFFFFFFFFFFFFFF           FFFFFFBBBBB"
      ],
      "keys": [ "", "578", "752", "246", "643", "248", "233", "428", "208", "440", "112", "276", "616", "826", "528", "804", "56", "250",
                "203", "442", "703", "40", "348", "642", "498", "756", "380", "705", "191", "688", "70", "100", "499", "268", "724", "8",
                "807", "792", "300" ],
      "data": {
          "8": "Albania",
          "40": "Austria",
          "56": "Belgium",
          "70": "Bosnia and Herzegovina",
          "100": "Bulgaria",
          "112": "Belarus",
          "191": "Croatia",
          "203": "Czech Republic",
          "208": "Denmark",
          "233": "Estonia",
          "246": "Finland",
          "250": "France",
          "268": "Georgia",
          "276": "Germany",
          "300": "Greece",
          "348": "Hungary",
          "380": "Italy",
          "428": "Latvia",
          "440": "Lithuania",
          "442": "Luxembourg",
          "498": "Republic of Moldova",
          "499": "Montenegro",
          "528": "Netherlands",
          "578": "Norway",
          "616": "Poland",
          "642": "Romania",
          "643": "Russia",
          "688": "Serbia",
          "703": "Slovakia",
          "705": "Slovenia",
          "724": "Spain",
          "752": "Sweden",
          "756": "Switzerland",
          "792": "Turkey",
          "804": "Ukraine",
          "807": "The former Yugoslav Republic of Macedonia",
          "826": "United Kingdom"
      }
    }

缩小和压缩后文件大小：2071 bytes(带键和数据映射时)、1645 bytes(不带键和数据映射时).

为测试实现, [`demo.json`](https://github.com/mapbox/mbtiles-spec/blob/master/1.1/demo.json) 存储了一个包含65501不同键的网格. 这是该版本UTFGrid能够承载的最大数据量. 开发者需要检查：对所有x/y坐标应返回key `y * 256 + x` , 例外：y = 255 和 x >= 222  x <= 255时返回65501 (JSON中最大的codepoint数).

代码验证程序示例如下:

```javascript
json = JSON.parse(/* demo.json */);
var key = 0;
for (var y = 0; y < 256; y++) {
    for (var x = 0; x < 256; x++) {
        var code = json.grid[y].charCodeAt(x);
        if (code >= 93) code--;
        if (code >= 35) code--;
        code -= 32;

        assert(code == key) {

        if (key < 65501) key++;
    }
}
```
